name: deploy-to-pages
on: [push]
jobs:
  do-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '14'
      - name: Install Dependencies
        run: npm install && npm install -g gh-pages
        working-directory: ./client
      - name: Build React Appliction
        run: npm run build
        working-directory: ./client
        env:
          CI: false
      - name: Move Things
        run: mv client/build ./build
      - name: Stash Changes
        run: git stash push -u
      - name: Fetch Remotes
        run: git fetch
      - name: Checkout Pages Repo
        run: git checkout gh-pages
      - name: Pop Stash
        run: git stash pop
      - name: Move Things
        run: cp -rf build ./
      - name: Commit Changes
        run: git commit -am "auto generated commit"
      - name: Push Changes
        run: git push origin gh-pages